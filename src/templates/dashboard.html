{% extends 'base/base.html' %}

{% block title %} {{ title }} {% endblock %}

{% block herotitle %} Vista Principal {% endblock %}
{% block herosubtitle %} Bienvenido <a class="font-w600">{{ username }}</a>, todo esta bien. {% endblock %}
{% block contenttitle %} {% endblock %}
{% block contentsubtitle %} {% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='assets/css/gauges.css') }}">
{% endblock %}

{% block content %}
<script>
    // Variable global para el sexo del usuario (para los cálculos de los gauges)
    window.userSex = '{{ estaticodata[0][4] if estaticodata else "M" }}';
</script>
    <div>
        <!-- Mensaje -->
        {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-danger alert-dismissable" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <p class="mb-0">{{ message }}</p>
                </div>
            {% endfor %}
        {% endif %}
        {% endwith %}
        <!-- END Mensaje -->
    </div>

    <!-- Overview -->
    <div class="row row-deck">
        <div class="col-sm-6 col-xl-4">
            <!-- Pending Orders -->
            <div class="block block-rounded d-flex flex-column">
                <div class="block-content block-content-full flex-grow-1 d-flex justify-content-between align-items-center">
                    <dl class="mb-0">
                        <dt class="font-size-h2 font-w700">{{ agua }}</dt>
                        <dd class="text-muted mb-0">Litros de agua</dd>
                    </dl>
                    <div class="item item-rounded bg-body">
                        <i class="fa fa-glass-whiskey font-size-h3 text-primary"></i>
                    </div>
                </div>
                <div class="block-content block-content-full block-content-sm bg-body-light font-size-sm">
                    <a class="font-w500 d-flex align-items-center">
                        Cantidad de litros de agua que deberías consumir por día.
                    </a>
                </div>
            </div>
            <!-- END Pending Orders -->
        </div>
        <div class="col-sm-6 col-xl-4">
            <!-- New Customers -->
            <div class="block block-rounded d-flex flex-column">
                <div class="block-content block-content-full flex-grow-1 d-flex justify-content-between align-items-center">
                    <dl class="mb-0">
                        <dt class="font-size-h2 font-w700">{{ abdomen }}</dt>
                        <dd class="text-muted mb-0">Perímetro de Abdomen</dd>
                    </dl>
                    <div class="item item-rounded bg-body">
                        <i class="fa fa-heartbeat font-size-h3 text-primary"></i>
                    </div>
                </div>
                <div class="block-content block-content-full block-content-sm bg-body-light font-size-sm">
                    <a class="font-w500 d-flex align-items-center">
                        {{ abdcatrisk }}
                    </a>
                </div>
            </div>
            <!-- END New Customers -->
        </div>
        <div class="col-sm-6 col-xl-4">
            <!-- Messages -->
            <div class="block block-rounded d-flex flex-column">
                <div class="block-content block-content-full flex-grow-1 d-flex justify-content-between align-items-center">
                    <dl class="mb-0">
                        <dt class="font-size-h2 font-w700">{{ bodyscore }}</dt>
                        <dd class="text-muted mb-0">Puntaje corporal</dd>
                    </dl>
                    <div class="item item-rounded bg-body">
                        <i class="fa fa-user font-size-h3 text-primary"></i>
                    </div>
                </div>
                <div class="block-content block-content-full block-content-sm bg-body-light font-size-sm">
                    <a class="font-w500 d-flex align-items-center">
                        Complexión física: {{ categoria }}
                    </a>
                </div>
            </div>
            <!-- END Messages -->
        </div>
        <div class="col-sm-12">
            <div class="block block-rounded">
                <div class="block-header block-header-default align-items-start flex-column flex-sm-row">
                    <div>
                        <h3 class="block-title mb-1">Reloj de rendimiento</h3>
                        <p class="mb-0 text-muted font-size-sm">Comparativo de fatrate y leanrate según el escenario y el periodo seleccionado.</p>
                    </div>
                    <div class="block-options">
                        <span class="badge badge-primary font-size-sm mr-2">Objetivo fatrate: {{ fatrate_target|round(2) }} kg/sem</span>
                        <span class="badge badge-success font-size-sm">Objetivo leanrate: {{ leanrate_target|round(2) }} kg/sem</span>
                    </div>
                </div>
                <div class="block-content block-content-full">
                    <div class="row">
                        {% for scenario in performance_clock.values() %}
                        <div class="col-lg-4">
                            <h4 class="font-w700 font-size-h5">{{ scenario.label }}</h4>
                            <div class="table-responsive">
                                <table class="table table-sm table-borderless table-striped mb-0">
                                    <thead>
                                        <tr>
                                            <th>Periodo</th>
                                            <th>Fatrate</th>
                                            <th>Leanrate</th>
                                            <th>Confianza</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for timeframe in scenario.timeframes.values() %}
                                        <tr>
                                            <td class="font-w600">{{ timeframe.label }}</td>
                                            <td>
                                                {% if timeframe.fat_rate is not none %}
                                                    {% set fat_class = 'text-success' if timeframe.fat_rate <= 0 else 'text-danger' %}
                                                    <span class="font-w600 {{ fat_class }}">{{ timeframe.fat_rate|round(2) }} kg/sem</span>
                                                    {% if timeframe.fat_diff is not none %}
                                                        {% set fat_diff_class = 'text-success' if timeframe.fat_diff >= 0 else 'text-danger' %}
                                                        <div class="font-size-sm {{ fat_diff_class }}">Δ {{ timeframe.fat_diff|abs|round(2) }} vs ideal</div>
                                                    {% endif %}
                                                {% else %}
                                                    <span class="text-muted">Sin datos suficientes</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if timeframe.lean_rate is not none %}
                                                    {% set lean_class = 'text-success' if timeframe.lean_rate >= 0 else 'text-danger' %}
                                                    <span class="font-w600 {{ lean_class }}">{{ timeframe.lean_rate|round(2) }} kg/sem</span>
                                                    {% if timeframe.lean_diff is not none %}
                                                        {% set lean_diff_class = 'text-success' if timeframe.lean_diff >= 0 else 'text-danger' %}
                                                        <div class="font-size-sm {{ lean_diff_class }}">Δ {{ timeframe.lean_diff|abs|round(2) }} vs ideal</div>
                                                    {% endif %}
                                                {% else %}
                                                    <span class="text-muted">Sin datos suficientes</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% set confidence = timeframe.confidence %}
                                                {% if confidence.count > 0 %}
                                                    <span class="font-w600">{{ confidence.count }}</span> pesajes
                                                    <div class="text-muted font-size-sm">
                                                        {% if confidence.cv is not none %}
                                                            CV {{ (confidence.cv * 100)|round(1) }}%
                                                        {% else %}
                                                            CV n/d
                                                        {% endif %}
                                                    </div>
                                                {% else %}
                                                    <span class="text-muted">Sin registros</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- END Overview -->

    <!-- Gauges Horizontales -->
    <div class="row row-deck">
        <!-- IMC Gauge -->
        <div class="col-lg-4 col-md-6 col-sm-12">
            <div class="block block-rounded d-flex flex-column">
                <div class="block-content block-content-full flex-grow-1 d-flex justify-content-between align-items-center">
                    <dl class="mb-0">
                        <dt class="font-size-h2 font-w700">
                            {{ imc }}
                            {% if deltaimc>=0 %}
                            <span class="font-size-sm font-w600 text-success ml-2">
                                <i class="fa fa-caret-up"></i> {{ deltaimc }}%
                            </span>
                            {% else %}
                            <span class="font-size-sm font-w600 text-danger ml-2">
                                <i class="fa fa-caret-down"></i> {{ deltaimc }}%
                            </span>
                            {% endif %}
                        </dt>
                        <dd class="text-muted mb-0">Índice de masa corporal</dd>
                    </dl>
                    <div class="item item-rounded bg-body">
                        <i class="fa fa-weight font-size-h3 text-primary"></i>
                    </div>
                </div>
                <div class="block-content text-center overflow-hidden">
                    <!-- IMC Gauge -->
                    <div class="metric-gauge imc-gauge" data-value="{{ imc }}">
                        <div class="gauge-category bajo-peso"></div>
                        <div class="gauge-category normal"></div>
                        <div class="gauge-category sobrepeso"></div>
                        <div class="gauge-category obesidad"></div>
                    </div>
                </div>
                <div class="block-content block-content-full block-content-sm bg-body-light font-size-sm">
                    <a class="font-w500 d-flex align-items-center">
                        {{ imccat }}
                    </a>
                </div>
            </div>
        </div>
        
        <!-- FFMI Gauge -->
        <div class="col-lg-4 col-md-6 col-sm-12">
            <div class="block block-rounded d-flex flex-column">
                <div class="block-content block-content-full flex-grow-1 d-flex justify-content-between align-items-center">
                    <dl class="mb-0">
                        <dt class="font-size-h2 font-w700">
                            {{ ffmi }}
                            {% if deltaffmi>=0 %}
                            <span class="font-size-sm font-w600 text-success ml-2">
                                <i class="fa fa-caret-up"></i> {{ deltaffmi }}%
                            </span>
                            {% else %}
                            <span class="font-size-sm font-w600 text-danger ml-2">
                                <i class="fa fa-caret-down"></i> {{ deltaffmi }}%
                            </span>
                            {% endif %}
                        </dt>
                        <dd class="text-muted mb-0">Índice de masa magra corporal</dd>
                    </dl>
                    <div class="item item-rounded bg-body">
                        <i class="fa fa-dumbbell font-size-h3 text-primary"></i>
                    </div>
                </div>
                <div class="block-content text-center overflow-hidden">
                    <!-- FFMI Gauge -->
                    <div class="metric-gauge ffmi-gauge" data-value="{{ ffmi }}">
                        <div class="gauge-category muy-pobre"></div>
                        <div class="gauge-category pobre"></div>
                        <div class="gauge-category bajo"></div>
                        <div class="gauge-category casi-normal"></div>
                        <div class="gauge-category normal"></div>
                        <div class="gauge-category bueno"></div>
                        <div class="gauge-category muy-bueno"></div>
                        <div class="gauge-category excelente"></div>
                        <div class="gauge-category superior"></div>
                    </div>
                </div>
                <div class="block-content block-content-full block-content-sm bg-body-light font-size-sm">
                    <a class="font-w500 d-flex align-items-center">
                        {{ immccat }}
                    </a>
                </div>
            </div>
        </div>
        
        <!-- %BF Gauge -->
        <div class="col-lg-4 col-md-12 col-sm-12">
            <div class="block block-rounded d-flex flex-column">
                <div class="block-content block-content-full flex-grow-1 d-flex justify-content-between align-items-center">
                    <dl class="mb-0">
                        <dt class="font-size-h2 font-w700">
                            {{ bf }}%
                            {% if deltabf<=0 %}
                            <span class="font-size-sm font-w600 text-success ml-2">
                                <i class="fa fa-caret-down"></i> {{ deltabf }}%
                            </span>
                            {% else %}
                            <span class="font-size-sm font-w600 text-danger ml-2">
                                <i class="fa fa-caret-up"></i> {{ deltabf }}%
                            </span>
                            {% endif %}
                        </dt>
                        <dd class="text-muted mb-0">Porcentaje de grasa corporal</dd>
                    </dl>
                    <div class="item item-rounded bg-body">
                        <i class="fa fa-chart-pie font-size-h3 text-primary"></i>
                    </div>
                </div>
                <div class="block-content text-center overflow-hidden">
                    <!-- %BF Gauge -->
                    <div class="metric-gauge bf-gauge" data-value="{{ bf }}">
                        <div class="gauge-category esencial"></div>
                        <div class="gauge-category atletico"></div>
                        <div class="gauge-category fitness"></div>
                        <div class="gauge-category promedio"></div>
                        <div class="gauge-category alto"></div>
                        <div class="gauge-category obesidad"></div>
                    </div>
                </div>
                <div class="block-content block-content-full block-content-sm bg-body-light font-size-sm">
                    <a class="font-w500 d-flex align-items-center">
                        {{ bfcat }}
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- END Gauges Horizontales -->

    <!-- Statistics -->
    <div class="row">
        <div class="col-12">
            <!-- Earnings Summary -->
            <div class="block block-rounded flex-grow-1 d-flex flex-column">
                <div class="block-header block-header-default">
                    <h3 class="block-title">Pesos</h3>
                    <div class="block-options">
                        <button type="button" class="btn-block-option" data-toggle="block-option" data-action="state_toggle" data-action-mode="demo">
                            <i class="si si-refresh"></i>
                        </button>
                    </div>
                </div>
                <div class="block-content block-content-full flex-grow-1 d-flex align-items-center">
                    <!-- Earnings Chart Container -->
                    <!-- Chart.js Chart is initialized in js/pages/be_pages_dashboard.min.js which was auto compiled from _js/pages/be_pages_dashboard.js -->
                    <!-- For more info and examples you can check out http://www.chartjs.org/docs/ -->
                    <div id="chart-weight-apex" style="min-height: 415px;" class="w-100"></div>
                </div>
                <div class="block-content bg-body-light">
                    <div class="row items-push text-center w-100">
                        <div class="col-sm-4">
                            <dl class="mb-0">
                                <dt class="font-size-h3 font-w700">
                                    {% if deltapeso<=0 %}
                                    <i class="fa fa-arrow-down font-size-lg text-danger"></i> {{ deltapeso }} gr.
                                    {% else %}
                                    <i class="fa fa-arrow-up font-size-lg text-success"></i> {{ deltapeso }} gr.
                                    {% endif %}
                                </dt>
                                <dd class="text-muted mb-0">Variación de peso</dd>
                            </dl>
                        </div>
                        <div class="col-sm-4">
                            <dl class="mb-0">
                                <dt class="font-size-h3 font-w700">
                                    {% if deltapg<=0 %}
                                    <i class="fa fa-arrow-down font-size-lg text-danger"></i> {{ deltapg }} gr.
                                    {% else %}
                                    <i class="fa fa-arrow-up font-size-lg text-success"></i> {{ deltapg }} gr.
                                    {% endif %}
                                </dt>
                                <dd class="text-muted mb-0">Variación en la masa grasa</dd>
                            </dl>
                        </div>
                        <div class="col-sm-4">
                            <dl class="mb-0">
                                <dt class="font-size-h3 font-w700">
                                    {% if deltapm<=0 %}
                                    <i class="fa fa-arrow-down font-size-lg text-danger"></i> {{ deltapm }} gr.
                                    {% else %}
                                    <i class="fa fa-arrow-up font-size-lg text-success"></i> {{ deltapm }} gr.
                                    {% endif %}
                                </dt>
                                <dd class="text-muted mb-0">Variación en la masa magra</dd>
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END Earnings Summary -->
        </div>
    </div>
    <!-- END Statistics -->

    <!-- Base de datos -->
    <div class="block block-rounded">
        <ul class="nav nav-tabs nav-tabs-alt" data-toggle="tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link" href="#btabs-alt-static-stat">Perfil Estático</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="#btabs-alt-static-dyna">Perfil Dinámico</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#btabs-alt-static-anal">Analisis</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#btabs-alt-static-goal">Objetivos</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#btabs-alt-static-fore">Pronóstico</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#btabs-alt-static-diet">Dieta</a>
            </li>
        </ul>
        <div class="block-content tab-content">
            <div class="tab-pane" id="btabs-alt-static-diet" role="tabpanel">
                <div class="block-content block-content-full">
                    <!-- DataTables init on table by adding .js-dataTable-full-pagination class, functionality is initialized in js/pages/be_tables_datatables.min.js which was auto compiled from _js/pages/be_tables_datatables.js -->
                    <table class="table table-bordered table-striped table-vcenter js-dataTable-full-pagination">
                        <thead>
                            <tr>
                                <th>Calorias</th>
                                <th>Proteína</th>
                                <th class="d-none d-sm-table-cell">Grasa</th>
                                <th class="d-none d-sm-table-cell">Carbohidratos</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dieta in dieta %}
                            <tr>
                                <td class="font-w600 font-size-sm">{{dieta.2}}</td>
                                <td class="font-w600 font-size-sm">{{dieta.3}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dieta.4}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dieta.5}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-pane active" id="btabs-alt-static-dyna" role="tabpanel">
                <div class="block-content block-content-full">
                    <!-- DataTables init on table by adding .js-dataTable-full-pagination class, functionality is initialized in js/pages/be_tables_datatables.min.js which was auto compiled from _js/pages/be_tables_datatables.js -->
                    <table class="table-responsive table-bordered table-striped table-vcenter js-dataTable-full-pagination-date">
                        <thead>
                            <tr>
                                <th>Fecha de Registro</th>
                                <th>Peso</th>
                                <th class="d-none d-sm-table-cell">Perimetro de abdomen</th>
                                <th class="d-none d-sm-table-cell">Perimetro de cíntura</th>
                                <th class="d-none d-sm-table-cell">Perimetro de cadera</th>
                                <th>% de grasa corporal</th>
                                <th class="d-none d-sm-table-cell">IMC</th>
                                <th>IMMC</th>
                                <th class="d-none d-sm-table-cell">Peso graso</th>
                                <th class="d-none d-sm-table-cell">Peso magro</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dinamico in dinamico %}
                            <tr>
                                <td class="font-w600 font-size-sm">{{dinamico.2}}</td>
                                <td class="font-w600 font-size-sm">{{dinamico.6}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.5}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.3}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.4}}</td>
                                <td class="font-w600 font-size-sm">{{dinamico.7}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.8}}</td>
                                <td class="font-w600 font-size-sm">{{dinamico.9}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.10}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.11}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-pane" id="btabs-alt-static-anal" role="tabpanel">
                <div class="block-content block-content-full">
                    <!-- DataTables init on table by adding .js-dataTable-full-pagination class, functionality is initialized in js/pages/be_tables_datatables.min.js which was auto compiled from _js/pages/be_tables_datatables.js -->
                    <table class="table-responsive table-bordered table-striped table-vcenter js-dataTable-full-pagination-date">
                        <thead>
                            <tr>
                                <th>Fecha de Registro</th>
                                <th class="d-none d-sm-table-cell">Δ de días</th>
                                <th>Δ de peso</th>
                                <th class="d-none d-sm-table-cell">Categoría Δ Peso </th>
                                <th class="d-none d-sm-table-cell">Δ PG</th>
                                <th class="d-none d-sm-table-cell">Δ PM</th>
                                <th class="d-none d-sm-table-cell">Relación de perdida de PM (RPPM)</th>
                                <th>Categoría de (RPPM)</th>
                                <th class="d-none d-sm-table-cell">Relación de ganancia de PG (RGPG)</th>
                                <th>Categoría de RGPG</th>
                                <th class="d-none d-sm-table-cell">Puntaje IMMC</th>
                                <th class="d-none d-sm-table-cell">Puntaje BF</th>
                                <th>Puntaje corporal</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dinamico in dinamico %}
                            <tr>
                                <td class="font-w600 font-size-sm">{{dinamico.2}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.12}}</td>
                                <td class="font-w600 font-size-sm">{{dinamico.13}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.19}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.15}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.17}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.20}}</td>
                                <td class="font-w600 font-size-sm">{{dinamico.21}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.22}}</td>
                                <td class="font-w600 font-size-sm">{{dinamico.23}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.24}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.25}}</td>
                                <td class="font-w600 font-size-sm">{{dinamico.26}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-pane" id="btabs-alt-static-fore" role="tabpanel">
                <div class="block-content block-content-full">
                    <!-- DataTables init on table by adding .js-dataTable-full-pagination class, functionality is initialized in js/pages/be_tables_datatables.min.js which was auto compiled from _js/pages/be_tables_datatables.js -->
                    <table class="table-responsive table-bordered table-striped table-vcenter js-dataTable-full-pagination-date">
                        <thead>
                            <tr>
                                <th>Fecha de Registro</th>
                                <th class="d-none d-sm-table-cell">Peso objetivo</th>
                                <th class="d-none d-sm-table-cell">Peso magro objetivo</th>
                                <th class="d-none d-sm-table-cell">Peso graso objetivo</th>
                                <th class="d-none d-sm-table-cell">Perímetro de abdomen</th>
                                <th class="d-none d-sm-table-cell">Perímetro de cintura</th>
                                <th class="d-none d-sm-table-cell">Perímetro de cadera</th>
                                <th class="d-none d-sm-table-cell">Días de aumento de peso</th>
                                <th class="d-none d-sm-table-cell">Días de descenso de peso</th>
                                <th>Días para llegar al objetivo</th>
                                <th class="d-none d-sm-table-cell">Categoria</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dinamico in dinamico %}
                            <tr>
                                <td class="font-w600 font-size-sm">{{dinamico.2}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.30}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.31}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.32}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.33}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.34}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.35}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.27}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.28}}</td>
                                <td class="font-w600 font-size-sm">{{dinamico.29}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{dinamico.36}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-pane" id="btabs-alt-static-stat" role="tabpanel">
                <div class="block-content block-content-full">
                    <!-- DataTables init on table by adding .js-dataTable-full-pagination class, functionality is initialized in js/pages/be_tables_datatables.min.js which was auto compiled from _js/pages/be_tables_datatables.js -->
                    <table class="table table-bordered table-striped table-vcenter js-dataTable-full-pagination">
                        <thead>
                            <tr>
                                <th>Nombre y apellido</th>
                                <th class="d-none d-sm-table-cell">DNI</th>
                                <th class="d-none d-sm-table-cell">Número de Telefono</th>
                                <th class="d-none d-sm-table-cell">Email</th>
                                <th class="d-none d-sm-table-cell">Sexo</th>
                                <th class="d-none d-sm-table-cell">Fecha de Nacimiento</th>
                                <th class="d-none d-sm-table-cell">Altura</th>
                                <th class="d-none d-sm-table-cell">Cuello</th>
                                <th class="d-none d-sm-table-cell">Muñeca</th>
                                <th class="d-none d-sm-table-cell">Tobillo</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for estatico in estatico %}
                            <tr>
                                <td class="font-w600 font-size-sm">{{estatico.0}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{estatico.1}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{estatico.2}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{estatico.3}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{estatico.4}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{estatico.5}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{estatico.6}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{estatico.7}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{estatico.8}}</td>
                                <td class="d-none d-sm-table-cell font-w600 font-size-sm">{{estatico.9}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-pane" id="btabs-alt-static-goal" role="tabpanel">
                <div class="block-content block-content-full">
                    <!-- DataTables init on table by adding .js-dataTable-full-pagination class, functionality is initialized in js/pages/be_tables_datatables.min.js which was auto compiled from _js/pages/be_tables_datatables.js -->
                    <table class="table table-bordered table-striped table-vcenter js-dataTable-full-pagination">
                        <thead>
                            <tr>
                                <th>IMMC objetivo</th>
                                <th>BF objetivo</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for objetivo in objetivo %}
                            <tr>
                                <td class="font-w600 font-size-sm">{{objetivo.1}}</td>
                                <td class="font-w600 font-size-sm">{{objetivo.2}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- END Base de datos -->

{% endblock %}

{% block customscripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.1.0/chart.min.js"></script>
<!--Plugin CSS file with desired skin-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/css/ion.rangeSlider.min.css"/>

<!--Plugin JavaScript file-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/js/ion.rangeSlider.min.js"></script>   
<script>
    jQuery(function(){
        // Set Global Chart.js configuration
        Chart.defaults.color                                = '#999';
        Chart.defaults.scale.grid.color                     = 'transparent';
        Chart.defaults.scale.grid.zeroLineColor             = 'transparent';
        Chart.defaults.elements.line.borderWidth            = 2;
        Chart.defaults.elements.point.radius                = 4;
        Chart.defaults.elements.point.hoverRadius           = 6;
        Chart.defaults.plugins.tooltip.radius               = 4;
        Chart.defaults.plugins.legend.display               = true;

        // Prepare data for ApexCharts
        var dinamicoData = {{ dinamico|tojson }};
        var dates = [];
        var weights = [];
        var fatMassKg = []; // Array para Kilos Grasos

        if (dinamicoData && dinamicoData.length > 0) {
            dinamicoData.forEach(function(entry) {
                dates.push(entry[2]); // FECHA_REGISTRO
                var currentWeight = parseFloat(entry[6]); // PESO_ACTUAL
                var bodyFatPercentage = parseFloat(entry[10]); // PORCENTAJE_GRASA_CORPORAL_NUM
                
                weights.push(currentWeight);
                
                // Calcular Kilos Grasos: Peso * (%Grasa / 100)
                var currentFatMass = currentWeight * (bodyFatPercentage / 100.0);
                fatMassKg.push(currentFatMass.toFixed(1)); // Guardar con 1 decimal
            });
        }

        var today = new Date();
        var oneYearAgo = new Date(new Date().setFullYear(today.getFullYear() - 1));

        var optionsApexWeight = {
          series: [{
            name: 'Peso (Kg)',
            data: weights
          }, {
            name: 'Kilos Grasos (Kg)',
            data: fatMassKg
          }],
          colors: ['#808080', '#e56767'], // Gris para Peso Total, color #e56767 para Kilos Grasos
          chart: {
            height: 400, // Aumentada la altura
            type: 'line',
            width: '100%',
            zoom: {
              enabled: true
            },
            toolbar: {
              show: true
            }
          },
          dataLabels: {
            enabled: false
          },
          stroke: {
            curve: 'smooth',
            width: [2, 2]
          },
          title: {
            text: 'Evolución del Peso y Kilos Grasos',
            align: 'left'
          },
          markers: {
            size: 3
          },
          xaxis: {
            type: 'datetime',
            min: oneYearAgo.getTime(),
            max: today.getTime(),
            categories: dates,
            title: {
              text: 'Fecha'
            },
            labels: {
              datetimeUTC: false,
              format: 'dd MMM yy'
            }
          },
          yaxis: { // Configuración para un único eje Y
            title: {
              text: 'Kilogramos (Kg)'
            },
            labels: {
              formatter: function (val) { 
                return val !== null && val !== undefined ? val.toFixed(1) + " Kg" : ""; 
              }
            }
          },
          tooltip: {
            x: {
              format: 'dd MMM yyyy'
            },
            y: [
                {
                    formatter: function(value) {
                        return value !== null && value !== undefined ? value.toFixed(1) + " Kg" : "";
                    }
                },
                {
                    formatter: function(value) {
                        return value !== null && value !== undefined ? parseFloat(value).toFixed(1) + " Kg" : "";
                    }
                }
            ]
          },
          legend: {
            position: 'top',
            horizontalAlign: 'right',
            floating: true,
            offsetY: -25,
            offsetX: -5
          },
          noData: {
            text: 'No hay datos disponibles.',
            align: 'center',
            verticalAlign: 'middle',
            offsetX: 0,
            offsetY: 0,
            style: {
              fontSize: '14px'
            }
          }
        };

        var chartElement = document.querySelector("#chart-weight-apex");
        if (chartElement) {
            var chartApexWeight = new ApexCharts(chartElement, optionsApexWeight);
            chartApexWeight.render();
        } else {
            console.error("Element #chart-weight-apex not found for ApexCharts.");
        }
    });
</script>
<!-- Gauges JavaScript -->
<script src="{{ url_for('static', filename='assets/js/gauges.js') }}"></script>
{% endblock %}

